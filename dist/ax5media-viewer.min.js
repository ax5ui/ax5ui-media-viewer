"use strict";!function(i,e){var t=ax5.util,a=function(){var i,a=this;e&&e.call(this),this.queue=[],this.config={clickEventName:"click",theme:"default",animateTime:250,columnKeys:{src:"src",poster:"poster",html:"html"},loading:{icon:"",text:"Now Loading"},viewer:{prevHandle:!1,nextHandle:!1,ratio:16/9},media:{prevHandle:"<",nextHandle:">",width:36,height:36,list:[]}},this.openTimer=null,this.closeTimer=null,this.selectedIndex=0,i=this.config;var d=function(i){return'\n                <div data-ax5-ui-media-viewer="{{id}}">\n                    <div data-media-viewer-els="viewer"></div>\n                    <div data-media-viewer-els="viewer-loading">\n                        <div class="ax5-ui-media-viewer-loading-holder">\n                            <div class="ax5-ui-media-viewer-loading-cell">\n                                {{{loading.icon}}}\n                                {{{loading.text}}}\n                            </div>\n                        </div>\n                    </div>\n                    {{#media}}\n                    <div data-media-viewer-els="media-list-holder">\n                        <div data-media-viewer-els="media-list-prev-handle" style="width:{{width}}px;height:{{height}}px;">{{{prevHandle}}}</div>\n                        <div data-media-viewer-els="media-list">\n                            <div data-media-viewer-els="media-list-table">\n                            {{#list}}\n                                <div data-media-viewer-els="media-list-table-td">\n                                    {{#image}}\n                                    <div data-media-thumbnail="{{@i}}" style="width:{{width}}px;height:{{height}}px;">\n                                        <img src="{{'+i.poster+'}}" data-media-thumbnail-image="{{@i}}" />\n                                    </div>\n                                    {{/image}}\n                                    {{#video}}\n                                    <div data-media-thumbnail="{{@i}}" style="width:{{width}}px;height:{{height}}px;">\n                                        {{#'+i.poster+'}}<img src="{{.}}" data-media-thumbnail-video="{{@i}}" />>{{/'+i.poster+"}}\n                                        {{^"+i.poster+'}}<a data-media-thumbnail-video="{{@i}}" style="height:{{height}}px;">{{{media.'+i.poster+"}}}</a>{{/"+i.poster+'}}\n                                    </div>\n                                    {{/video}}\n                                </div>\n                            {{/list}}\n                            </div>\n                        </div>\n                        <div data-media-viewer-els="media-list-next-handle" style="width:{{width}}px;height:{{height}}px;">{{{nextHandle}}}</div>\n                    </div>\n                    {{/media}}\n                </div>\n                '},n=function(){var e=jQuery.extend(!0,{},i),t=d(i.columnKeys);e.id=this.id;try{return ax5.mustache.render(t,e)}finally{e=null,t=null}},s=function(e,d){var n,s="",l={thumbnail:function(i){this.select(i.getAttribute("data-media-thumbnail"))},prev:function(i){this.selectedIndex>0&&this.select(this.selectedIndex-1)},next:function(e){this.selectedIndex<i.media.list.length-1&&this.select(this.selectedIndex+1)},viewer:function(e){a.onClick&&a.onClick.call({media:i.media.list[this.selectedIndex]})}};if(d=t.findParentNode(e.target,function(i){return i.getAttribute("data-media-thumbnail")?(s="thumbnail",!0):"media-list-prev-handle"==i.getAttribute("data-media-viewer-els")?(s="prev",!0):"media-list-next-handle"==i.getAttribute("data-media-viewer-els")?(s="next",!0):"viewer"==i.getAttribute("data-media-viewer-els")?(s="viewer",!0):a.target.get(0)==i?!0:void 0})){for(var h in l){n=l[s].call(this,d);break}return this}return this},l=function(){if(i.media&&i.media.list&&i.media.list.length>0){for(var e=i.media.list.length,t=0;e--;)if(i.media.list[e].selected){t=e;break}0==t&&(i.media.list[0].selected=!0);try{return t}finally{e=null,t=null}}};this.init=function(){this.onStateChanged=i.onStateChanged,this.onClick=i.onClick,this.id="ax5-media-viewer-"+ax5.getGuid(),i.target&&i.media&&i.media.list&&i.media.list.length>0&&this.attach(i.target)},this.attach=function(i,e){return i||console.log(ax5.info.getError("ax5mediaViewer","401","setConfig")),"undefined"!=typeof e&&this.setConfig(e,!1),this.target=jQuery(i),this.target.html(n.call(this)),this.$={root:this.target.find("[data-ax5-ui-media-viewer]"),viewer:this.target.find('[data-media-viewer-els="viewer"]'),"viewer-loading":this.target.find('[data-media-viewer-els="viewer-loading"]'),"list-holder":this.target.find('[data-media-viewer-els="media-list-holder"]'),"list-prev-handle":this.target.find('[data-media-viewer-els="media-list-prev-handle"]'),list:this.target.find('[data-media-viewer-els="media-list"]'),"list-table":this.target.find('[data-media-viewer-els="media-list-table"]'),"list-next-handle":this.target.find('[data-media-viewer-els="media-list-next-handle"]')},this.align(),jQuery(window).unbind("resize.ax5media-viewer-"+this.id).bind("resize.ax5media-viewer-"+this.id,function(){this.align()}.bind(this)),this.target.unbind("click").bind("click",function(i){i=i||window.event,s.call(this,i),t.stopEvent(i)}.bind(this)),this.select(l.call(this)),this},this.align=function(){if(this.$.viewer.css({height:this.$.viewer.width()/i.viewer.ratio}),"image"==this.$.viewer.data("media-type")){var e=this.$.viewer.find("img");e.css({left:(this.$.viewer.width()-e.width())/2,width:this.$.viewer.height()*this.$.viewer.data("img-ratio"),height:this.$.viewer.height()})}else"video"==this.$.viewer.data("media-type")&&this.$.viewer.find("iframe").css({width:this.$.viewer.height()*this.$.viewer.data("img-ratio"),height:this.$.viewer.height()});return this.$["viewer-loading"].css({height:this.$.viewer.height()}),this},this.select=function(){var e={image:function(e,t){a.$["viewer-loading"].show();var d=[this.$.viewer.width(),this.$.viewer.height()],n=new Image;return n.src=e.image[i.columnKeys.src],n.onload=function(){a.$["viewer-loading"].fadeOut();var i=d[1],e=i*n.width/n.height;t(n,Math.floor(e),i)},n},video:function(e,t){a.$["viewer-loading"].show();var d=[this.$.viewer.width(),this.$.viewer.height()],n=jQuery(e.video[i.columnKeys.html]);t(n,d[0],d[1]),a.$["viewer-loading"].fadeOut()}},t={image:function(i,e,t){i.width=e,i.height=t;var a=$(i);this.$.viewer.html(a),a.css({left:(this.$.viewer.width()-e)/2}),this.$.viewer.data("media-type","image"),this.$.viewer.data("img-ratio",e/t)},video:function(i,e,t){i.css({width:e,height:t}),this.$.viewer.html(i),this.$.viewer.data("media-type","video"),this.$.viewer.data("img-ratio",e/t)}},d=function(i){this.$.list.find("[data-media-thumbnail]").removeClass("selected");var e=this.$.list.find("[data-media-thumbnail="+i+"]").addClass("selected"),t=e.position(),a=e.width(),d=this.$.list.width(),n=this.$["list-table"].position().left,s=0;t.left>n+d&&(s=d-(t.left+a)),n!=s&&this.$["list-table"].css({left:s}),e=null,t=null,a=null,d=null,n=null,s=null};return function(a){if("undefined"==typeof a)return this;this.selectedIndex=Number(a);var n=i.media.list[a];d.call(this,a);for(var s in e)if(n[s]){e[s].call(this,n,t[s].bind(this));break}return this}}(),this.setMediaList=function(e){return i.media.list=[].concat(e),this.attach(i.target),this},this.main=function(){arguments&&t.isObject(arguments[0])?this.setConfig(arguments[0]):this.init()}.apply(this,arguments)};i.mediaViewer=function(){return t.isFunction(e)&&(a.prototype=new e),a}()}(ax5.ui,ax5.ui.root);